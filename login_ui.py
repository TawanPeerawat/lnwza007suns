import streamlit as st
from database import UserDatabase

# р╕кр╕гр╣Йр╕▓р╕Зр╕нр╕┤р╕Щр╕кр╣Бр╕Хр╕Щр╕Лр╣Мр╕Вр╕нр╕Зр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е
db = UserDatabase()

# р╕Хр╕▒р╣Йр╕Зр╕Др╣Ир╕▓р╕лр╕Щр╣Йр╕▓р╣Ар╕зр╣Зр╕Ъ
st.set_page_config(page_title="Login System", page_icon="ЁЯФР", layout="centered")

# UI р╕кр╕│р╕лр╕гр╕▒р╕Ъ Login
st.title("ЁЯФР р╕гр╕░р╕Ър╕Ър╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ")

# р╕Яр╕нр╕гр╣Мр╕б Login
with st.form("login_form"):
    username = st.text_input("ЁЯСд р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й", placeholder="р╕Бр╕гр╕нр╕Бр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Вр╕нр╕Зр╕Др╕╕р╕У")
    password = st.text_input("ЁЯФС р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ", type="password", placeholder="р╕Бр╕гр╕нр╕Бр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Вр╕нр╕Зр╕Др╕╕р╕У")
    login_button = st.form_submit_button("р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ")

# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ
if login_button:
    if db.login(username, password):
        st.success(f"тЬЕ р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╕кр╕│р╣Ар╕гр╣Зр╕И! р╕вр╕┤р╕Щр╕Фр╕╡р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ъ {username}")
    else:
        st.error("тЭМ р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕лр╕гр╕╖р╕нр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З")

# р╕Яр╕нр╕гр╣Мр╕бр╕кр╕│р╕лр╕гр╕▒р╕Ър╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б
st.subheader("ЁЯУЭ р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Ър╕▒р╕Нр╕Кр╕╡? р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Бр╣Ар╕ер╕в!")
with st.form("register_form"):
    new_username = st.text_input("ЁЯСд р╕кр╕гр╣Йр╕▓р╕Зр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й", placeholder="р╕Хр╕▒р╣Йр╕Зр╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕Вр╕нр╕Зр╕Др╕╕р╕У")
    new_email = st.text_input("ЁЯУз р╕нр╕╡р╣Ар╕бр╕е", placeholder="р╕Бр╕гр╕нр╕Бр╕нр╕╡р╣Ар╕бр╕ер╕Вр╕нр╕Зр╕Др╕╕р╕У")
    new_password = st.text_input("ЁЯФС р╕Хр╕▒р╣Йр╕Зр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ", type="password", placeholder="р╕Хр╕▒р╣Йр╕Зр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╕Вр╕нр╕Зр╕Др╕╕р╕У")
    register_button = st.form_submit_button("р╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б")

# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Бр╕▓р╕гр╕кр╕бр╕▒р╕Др╕гр╕кр╕бр╕▓р╕Кр╕┤р╕Б
if register_button:
    result = db.register(new_username, new_password, new_email)
    if "р╕кр╕│р╣Ар╕гр╣Зр╕И" in result:
        st.success(result)
    else:
        st.error(result)

# р╕Ыр╕┤р╕Фр╕Бр╕▓р╕гр╣Ар╕Кр╕╖р╣Ир╕нр╕бр╕Хр╣Ир╕нр╕Рр╕▓р╕Щр╕Вр╣Йр╕нр╕бр╕╣р╕е
db.close_connection()
